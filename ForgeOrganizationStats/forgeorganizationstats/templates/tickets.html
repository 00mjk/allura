{% set hide_left_bar = True %}
{% extends g.theme.master %}

{% block title %}Organization stats{% endblock %}

{% block header %}
    Statistics about {{organization.fullname}}'s contribution â€“ Tickets
{% endblock %}

{% block content %}

  {% if organization and (organization.stats.visible or (c.user.username in c.project.admins())) %}
    <div class="grid-20">
      <ul>
        <li><a href="{{c.project.url()}}organizationstats">Go back to general statistics</a></li>
      </ul>
    </div>

    {% if data %}
    <div class="grid-20">
      <h2>Statistics by category</h2>
      <table>
        <thead>
          <tr>
            <th>Category</th>
            <th>Assigned tickets</th>
            <th>Solved tickets</th>
            <th>Revoked tickets</th>
            <th>Average solving time</th>
          </tr>
        </thead>
        <tbody> 
          {% for cat, el in data.items() %}
            <tr>
              <td>{% if cat %}{{cat.fullname}}{% else %}All categories{% endif %}</td>
              <td>{{el.assigned}}</td>
              <td>{{el.solved}}</td>
              <td>{{el.revoked}}</td>
              <td>
                {% if el.averagesolvingtime %}
                  {{el.averagesolvingtime.days}} days, 
                  {{el.averagesolvingtime.hours}} hours,
                  {{el.averagesolvingtime.minutes}} min
                {% else %}n/a{% endif %}
              </td>
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </div>
    {% endif %}
  {% else %}
    {% if not organization %}
      <h2>Invalid organization</h2>
      <div class="grid-20"> 
        You are looking for the statistics of an organization which doesn't exist on this forge. Check your url.
      </div>
    {% else %}
      <h2>Statistics not available</h2>
      <div class="grid-20"> 
        The administrator of this organization has set the preferences so that statistics are not visible
        to other users of the forge.
      </div>
    {% endif %}
  {% endif %}
{% endblock %}
