<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="${g.pyforge_templates}/master.html"/>
  <xi:include href="${c.app.templates}/lib.html" />

  <?python from pprint import pformat ?>

  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
    <title>${ticket.shorthand_id()}</title>
    <link rel="stylesheet" type="text/css" href="${g.app_static('css/hilite.css')}"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="feed.rss"/>
    <link rel="alternate" type="application/atom+xml" title="Atom" href="feed.atom"/>
    <style>
        .hidden { display: None }
        .ticket-num { font-size:20pt }
        .top-liner { border-top: 1px solid #ccc }
        .bottom-liner { border-bottom: 1px solid #ccc }
    </style>
  </head>

  <body>
    <div class="container">
        <article class="ticket">

            <h1>${ticket.shorthand_id()}</h1>
            <div>
              <a href="..">PluginRoot</a>
              <a href="edit/">Edit</a>
              <form style="display:inline; float:right"
                    method="GET"
                    action="../search">
                Search: <input name="q"/>
              </form>
            </div>
            <hr/>


            <div id="header" class="span-24 last">
                <h1 class="span-24 last">$ticket.summary</h1>
            </div>

            <div class="span-24">
                <div class="span-8">
                    <span class="quiet">owner:</span>
                    <span class="ticket-assigned-to">${ticket.assigned_to_name()}</span>
                </div>

                <div class="span-8">
                    <span class="quiet">status:</span>
                    <span class="ticket-status">$ticket.status</span>
                </div>

                <div class="span-8 last">
                    <span class="quiet">opened:</span>
                    <span class="ticket-create-date">${ticket.created_date.strftime('%H:%M:%S %Y-%m-%d')}</span>
                </div>
            </div>
            <div py:if="len(ticket.tags)">
              Tags: <span py:for="tag in ticket.tags">$tag.tag ($tag.count) </span>
            </div>

            <div class="span-24 last ticket-description">
                <div class="span-24 last quiet prepend-top bottom-liner">Description</div>
                <div class="span-24 last" py:content="Markup(g.markdown.convert(ticket.description))"/>
            </div>
            &nbsp;
            <div class="span-24 last custom-fields" py:if="globals.custom_fields">
                <div class="span-24 last quiet prepend-top bottom-liner">Custom Fields</div>
                <div class="span-24 last" py:for="field in globals.custom_fields.split(',')">
                    <span class="span-4"><label>${field}:</label></span>
                    <span class="span-20">${ticket.custom_fields.get(field, '')}</span>
                </div>
            </div>
            <hr/>
            ${list_attachments(list(ticket.attachments), False)}
            <hr/>
            <h2>Comments</h2>
            <div class="reply title-pane closed">
              <h3 class="title">Make a comment</h3>
              <div class="content">
                <form method="post" action="comments/reply">
                  <textarea rows="4" cols="60" name="text"></textarea><br/>
                  <input type="submit"/>
                </form>
              </div>
            </div>
            <py:for each="cmt in ticket.root_comments()">
              ${display_comment(cmt)}
            </py:for>
        </article>
    </div>
  </body>
  <script type="text/javascript" src="${g.app_static('js/comments.js')}"/>
</html>
