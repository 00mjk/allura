<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="${g.pyforge_templates}/master.html"/>

  <?python
    from pprint import pformat
    from pyforge.lib.security import has_artifact_access
    from pyforge import model as M
    ?>

  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type" py:replace="''"/>
    <title>#$ticket.ticket_num $ticket.summary</title>
    <link rel="stylesheet" type="text/css" href="${g.app_static('css/hilite.css')}"/>
    <link rel="stylesheet" type="text/css" href="${g.app_static('css/tracker.css')}"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="feed.rss"/>
    <link rel="alternate" type="application/atom+xml" title="Atom" href="feed.atom"/>
  </head>

  <body>
    <h1 class="title">Edit ticket #$ticket.ticket_num</h1>
    <div class="actions">
		  <py:if test="c.user and c.user != c.user.anonymous()">
			<a href="${ticket.url()}" class="btn ico-l"><b class="ui-icon ui-icon-search"></b> <span>View</span></a>
        ${c.subscribe_form.display(value=subscribed, action='subscribe', style='icon')}
      </py:if>
			<a href="${ticket.url()}feed.rss" class="btn ico"><b class="ui-icon ui-icon-signal-diag"></b> <span>Follow this Ticket</span></a>
    </div>
    <div class="content">
      <div class="row">
        <div class="column grid_12">
          ${c.ticket_form.display(action=ticket.url()+'update_ticket_from_widget', value=ticket, ticket=ticket)}
          <div class="span-19">
            ${c.attachment_list.display(attachments=list(ticket.attachments), edit_mode=has_artifact_access('write', ticket)())}
            <div py:if="has_artifact_access('write', ticket)()">
              <input type="button" value="Add Attachment" onclick="$('#artifact_form').show(); $(this).hide();"/>
              <div id="artifact_form" style="display: none; clear:both">
                <form method="post"
                      action="${ticket.url() + 'attach'}" enctype="multipart/form-data">
                  <ol>
                    <li>${file_field('file_info', 'File to upload')}</li>
                    <li><label>&nbsp;</label>${submit_button('Attach file')}</li>
                  </ol>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
