<div xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:attrs="attrs" class="discussion_subscription_form">
  <?python from pyforge.lib.security import has_artifact_access?>
  <div class="ui-button-set">
    <div class="clear span-3" py:if="not (allow_create_thread and has_artifact_access('post', value)())">
      &nbsp;
    </div>
    <div class="row">
      <div class="column grid_6" py:if="allow_create_thread and has_artifact_access('post', value)()">
        <a href="" class="ico-l new_topic"><b class="ui-icon ui-icon-plus"></b> <span>New Topic</span></a>
      </div>
      <div class="column grid_6" style="text-align:right">
        <a href="${value.email_link(subject=None)}" class="ico-l" 
           py:if="show_discussion_email"><b class="ui-icon ui-icon-mail-closed"></b> <span>Email</span></a>
        <a href="${value.url()}moderate/" class="ico-l"
           py:if="has_artifact_access('moderate', value)()"><b class="ui-icon ui-icon-check"></b> <span>Moderate</span></a>
        <a href="" class="ico-l follow"><b class="ui-icon ui-icon-signal-diag"></b> <span>Follow</span></a>
      </div>
    </div>
	</div>
  <div class="clear new_topic_form" style="display: none" py:if="allow_create_thread and has_artifact_access('post', value)()">
    <!-- <py:with var="context=c.widget.context_for('new_topic')">
      <py:with var="context['action']=value.url() + 'post'"> -->
        ${fields['new_topic'].display(action=value.url() + 'post',show_subject=show_subject)}
      <!-- </py:with>  
    </py:with> -->
  </div>
  <div class="clear"/>
  <form method="$method" action="$action" enctype="$enctype" class="follow_form">
    ${fields['threads'].display(value=threads)}
  </form>
</div>